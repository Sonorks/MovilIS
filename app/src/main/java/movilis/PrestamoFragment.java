package movilis;


import android.app.Activity;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.app.Fragment;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Adapter;
import android.widget.ArrayAdapter;
import android.widget.AutoCompleteTextView;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Spinner;
import android.widget.Toast;
import android.widget.ToggleButton;

import co.edu.udea.compumovil.lab4gr9.weather.movilis.R;

public class PrestamoFragment extends android.support.v4.app.Fragment {
    public PrestamoFragment() {
    }
    AutoCompleteTextView usuario;
    Spinner objeto;
    ToggleButton prestamoExterior;
    dataBaseManager manager;
    Button prestar;
    String articulos[];
    Cursor c;
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment
        View view = inflater.inflate(R.layout.fragment_prestamo,
                container, false);
        usuario = (AutoCompleteTextView) view.findViewById(R.id.usuarioPrestamo);
        objeto = (Spinner) view.findViewById(R.id.objPrestamo);
        prestamoExterior= (ToggleButton) view.findViewById(R.id.btnPrestamoTipo);
        prestar = (Button) view.findViewById(R.id.botonPrestamo);
        manager = new dataBaseManager(this.getContext());
        actualizarListaArticulos();
        long[] ids = new long[]{1000083090,1000084363,1000396239,1000894396,1001141925,1001233555,1001709761,1003931124,1007242269,1007273224,1010063118,1010115967,1013536820,1013558528,1015276227,1017125173,1017133210,1017133368,1017150068,1017153287,1017153656,1017159480,1017164237,1017168407,1017174170,1017174864,1017177494,1017181113,1017182924,1017183058,1017184951,1017186749,1017192861,1017195173,1017198529,1017198557,1017200544,1017200996,1017201121,1017202320,1017204873,1017206213,1017206365,1017206420,1017209111,1017209122,1017209565,1017209945,1017210162,1017211404,1017211416,1017211769,1017214614,1017215037,1017217563,1017218673,1017219319,1017220209,1017220827,1017221148,1017222591,1017222755,1017224696,1017224728,1017225531,1017225561,1017225764,1017226137,1017226739,1017228117,1017228606,1017229224,1017229497,1017233507,1017233591,1017233762,1017238295,1017239640,1017240670,1017241365,1017242181,1017244508,1017244568,1017244902,1017247479,1017248051,1020,1020158694,1020395603,1020406369,1020413454,1020414588,1020416643,1020419396,1020428164,1020430095,1020434561,1020434777,1020440799,1020443074,1020448886,1020448936,1020449213,1020449662,1020450639,1020450702,1020451252,1020452619,1020453324,1020455203,1020457670,1020457885,1020458040,1020460122,1020461249,1020462030,1020462834,1020464637,1020464753,1020465122,1020467413,1020469627,1020471441,1020471938,1020472551,1020472726,1020474862,1020476906,1020477307,1020478551,1020746526,1022095657,1026132222,1026142336,1026145787,1026147636,1026148047,1026148834,1026149462,1026150289,1026150499,1026151784,1026151982,1026152013,1026152721,1026153051,1026154938,1027882231,1027888770,1028008257,1032252858,1032447040,1033338767,1033655109,1035225562,1035227695,1035228203,1035228318,1035228678,1035228767,1035229186,1035233164,1035233399,1035419036,1035420638,1035421260,1035422022,1035423697,1035425952,1035427682,1035429901,1035433289,1035434051,1035434412,1035436986,1035832825,1035854761,1035856305,1035859551,1035862325,1035864659,1035868149,1035869023,1035869245,1035871434,1035873134,1035875072,1035875546,1035912221,1035913434,1035914233,1035914741,1035916860,1035918365,1035918664,1035919185,1036394312,1036396893,1036397327,1036401272,1036401398,1036402365,1036422312,1036610303,1036619527,1036621041,1036621544,1036622301,1036625435,1036635134,1036637420,1036637686,1036638008,1036642390,1036642798,1036645337,1036645341,1036647030,1036647944,1036648197,1036648399,1036648559,1036648901,1036652898,1036653728,1036654390,1036654402,1036654440,1036655594,1036656922,1036656961,1036657317,1036658180,1036658321,1036658557,1036662102,1036662291,1036664123,1036664353,1036667105,1036667320,1036668412,1036668605,1036669522,1036673923,1036780456,1036784131,1036927861,1036928603,1036934460,1036934864,1036936912,1036940038,1036941185,1036944403,1036944655,1036946171,1036949580,1036950669,1036952001,1036952236,1036953541,1036954574,1036954834,1036955071,1036956885,1036956957,1036957662,1037237224,1037268804,1037322123,1037325485,1037502955,1037524435,1037546853,1037570449,1037579781,1037587156,1037592525,1037595459,1037597229,1037601318,1037602238,1037605687,1037607456,1037607524,1037610178,1037611028,1037613088,1037614340,1037616814,1037616858,1037622083,1037622938,1037623341,1037623406,1037624127,1037627100,1037630073,1037632483,1037633965,1037634664,1037636255,1037637331,1037637865,1037638313,1037638381,1037638488,1037639399,1037639560,1037640884,1037643406,1037644168,1037644639,1037645540,1037646018,1037646450,1037648152,1037649475,1037650304,1037651190,1037651471,1037652833,1037652924,1037655173,1037655392,1037656786,1037657256,1037659652,1037974366,1037975885,1038098543,1038115559,1038333279,1038335444,1038358946,1038410721,1038413897,1038481420,1038627236,1039023641,1039288264,1039446689,1039448915,1039452184,1039452223,1039455449,1039455616,1039455925,1039457267,1039458008,1039458391,1039459720,1039460363,1039461483,1039462723,1039464074,1039464102,1039465385,1039465953,1039466899,1039466901,1039467369,1039469185,1039470957,1039886915,1040033479,1040035062,1040039865,1040040896,1040041013,1040044039,1040044908,1040044980,1040046113,1040046288,1040046559,1040046921,1040182176,1040323477,1040325128,1040732554,1040733689,1040736266,1040737700,1040738053,1040739166,1040739211,1040740369,1040741416,1040743153,1040744002,1040746069,1040746375,1040750143,1040752065,1040752294,1040752852,1040755640,1040800001,1041149171,1041149619,1041325808,1041328180,1042063412,1042063753,1042065724,1042708194,1042709015,1042770061,1044100844,1044504941,1044505061,1044505190,1044507887,1045022173,1045022241,1045022311,1045023847,1045024074,1045024228,1045050073,1045519955,1046668909,1046912393,1047435070,1047970878,1047971484,1048044345,1049628819,1055831540,1061776155,1062288219,1063136203,1063290447,1063299955,1064432937,1064435080,1065818434,1066180312,1066180331,1066514305,1066719631,1069485501,1069491267,1069500853,1072258615,1075289720,1077440585,1077450990,1077456418,1083915541,1085297235,1091671160,1098781353,1098781492,1102835284,1104415392,1105784633,1108763938,111111,1113677642,1114732514,1115086258,1118804790,1121207725,1122121192,1122140270,1123331976,1123634322,1127237470,1127605590,1128264116,1128264358,1128266552,1128267083,1128267624,1128276642,1128277546,1128283539,1128384790,1128391109,1128391834,1128394494,1128395206,1128395518,1128396011,1128397532,1128399040,1128399965,1128402291,1128402965,1128403262,1128416657,1128421063,1128424608,1128425368,1128427020,1128431178,1128431616,1128432142,1128432227,1128432386,1128434541,1128436444,1128437591,1128437919,1128440531,1128441196,1128441680,1128441735,1128441950,1128442271,1128444448,1128446860,1128447065,1128451979,1128453719,1128454115,1128454517,1128454855,1128455248,1128460828,1128461162,1128462978,1128473709,1128475025,1128478089,1140862377,1143868485,1146437892,1147956963,1148194306,1148697245,1148697464,1151948149,1152184354,1152186426,1152187679,1152189976,1152191183,1152192021,1152193904,1152194468,1152196003,1152197943,1152199791,1152200469,1152201461,1152201840,1152203227,1152203232,1152203500,1152204237,1152204602,1152204986,1152205006,1152206932,1152207448,1152207831,1152208412,1152208928,1152209135,1152209994,1152211488,1152211840,1152211981,1152212936,1152213042,1152213232,1152218190,1152219543,1152434319,1152434356,1152436594,1152437586,1152437631,1152438479,1152439790,1152440668,1152440734,1152441479,1152443197,1152443697,1152444539,1152445286,1152446222,1152448039,1152448619,1152450545,1152454724,1152455579,1152456881,1152457551,1152457953,1152458826,1152459040,1152461211,1152461332,1152462767,1152463333,1152464464,1152686066,1152687170,1152690979,1152691937,1152695598,1152697173,1152700319,1152701979,1152702276,1152702366,1152702902,1152703237,1152704122,1152704738,1152706402,1197214968,12026,1214713724,1214714057,1214714151,1214714488,1214714568,1214714749,1214715433,1214717460,1214719387,1214720376,1214723607,1214724017,1214724067,1214724863,1214724978,1214725618,1214726354,1214727562,1214728285,1214729117,1214729557,1214729728,1214731198,1214731811,1214732992,1214733974,1214734411,1214735339,1214737804,1214738989,1216714191,1216715985,1216716983,1216717188,1216718248,1216718777,1216720673,1216721757,1216722985,1216723347,123,1234567,1351465,1432432,15077281,15349386,15354998,15384541,15513792,15725970,16075812,168168,21424619,3413610,39289029,43107575,43271004,43684618,43848555,43876525,43906234,43920956,43991084,46541651,4684165,65794296,70091045,70099306,70256940,70543165,70698438,70726107,71054955,71225884,71227865,71228135,71260868,71265638,71269204,71271022,71272631,71274476,71275506,71279688,71290765,71292884,71314288,71360365,71363768,71365246,71375739,71376519,71377873,71388436,71526811,71595279,71609097,71639489,71658128,71728468,71738036,71764308,71783732,71784395,71788784,71791371,71798342,7180072,73191952,76307229,78709520,80186119,8061109,8061440,8064042,8064711,8064794,8101155,8102886,8105756,8106625,8127211,81531823,8162210,8175341,8355991,92539597,94513789};
        String[] users = new String[ids.length];
        for(int i = 0; i<ids.length; i++){
            users[i]=Long.toString(ids[i]);
        }
        ArrayAdapter<String> adapter = new ArrayAdapter<String>(this.getContext(),
                android.R.layout.simple_dropdown_item_1line, users);
        usuario.setAdapter(adapter);
        prestar.setOnClickListener(new View.OnClickListener(){
            @Override
            public void onClick(View v){
                Toast.makeText(getContext(),"Se ha realizado un nuevo prestamo",Toast.LENGTH_LONG).show();
                if (v.getId()== R.id.botonPrestamo){
                    prestarArticulo();
                }
            }
        });
        return view;
    }
    public void actualizarListaArticulos(){
        c = manager.cargarCursorArticulos();
        c.moveToFirst();
        int cantidad = c.getCount();
        int j = 0 ;
        articulos = new String[cantidad];
        for (int i = 0 ; i<cantidad ; i++){
            if(c.getString(3).equals("1")) {
                articulos[j] = c.getString(1);
                j++;
            }
            c.moveToNext();
        }
        ArrayAdapter<String> adapter = new ArrayAdapter<>(getContext(),android.R.layout.simple_spinner_dropdown_item,articulos);
        objeto.setAdapter(adapter);
    }
    public void prestarArticulo(){
        String articulo = objeto.getSelectedItem().toString();
        String user = usuario.getText().toString();
        if(articulo.equals("")){
            Toast.makeText(this.getContext(),"Por favor ingrese el articulo a prestar.",Toast.LENGTH_LONG).show();
        }
        else {
            if(user.equals("")){
                Toast.makeText(this.getContext(),"Por favor ingrese el usuario que solicita el prestamo.",Toast.LENGTH_LONG).show();
            }
            else {
                String tipoPrest = "0";
                if (prestamoExterior.isChecked()) {
                    tipoPrest = "1";
                }
                manager.actualizarArticulo(articulo, "0");
                manager.realizarPrestamo(articulo, user, tipoPrest);
                actualizarListaArticulos();
            }
        }
    }
}
